<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kettle on Aiar's Site</title><link>https://aiar.site/tags/kettle/</link><description>Recent content in Kettle on Aiar's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 11 Jan 2024 10:21:10 +0800</lastBuildDate><atom:link href="https://aiar.site/tags/kettle/index.xml" rel="self" type="application/rss+xml"/><item><title>crontab定时执行Kettle Job</title><link>https://aiar.site/post/9238c7b48c0d46679242255cb1d09f96/</link><pubDate>Thu, 11 Jan 2024 10:21:10 +0800</pubDate><guid>https://aiar.site/post/9238c7b48c0d46679242255cb1d09f96/</guid><description>&lt;img src="https://s11.ax1x.com/2024/01/09/pFp61fK.png" alt="Featured image of post crontab定时执行Kettle Job" />&lt;p>&lt;strong>注：使用 corntab 进行调度务必请将Kettle自身调度和循环关闭&lt;/strong>&lt;/p>
&lt;h2 id="1环境准备">1.环境准备&lt;/h2>
&lt;h3 id="11-检查资源库配置文件-kettlerepositoriesxml-存在性">1.1 检查资源库配置文件 &lt;code>.kettle/repositories.xml&lt;/code> 存在性&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ cat /home/etl/.kettle/repositories.xml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>不存在则以 &lt;code>1.2&lt;/code> 中内容模板新建文件&lt;/p>
&lt;h3 id="12-检查资源库路径是否符合预期">1.2 检查资源库路径是否符合预期&lt;/h3>
&lt;p>将 &lt;code>&amp;lt;base_directory&amp;gt;&amp;lt;/base_directory&amp;gt;&lt;/code> 标签中的目录位置修改为期望的资源库路径&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;repositories&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;repository&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;id&amp;gt;&lt;/span>KettleFileRepository&lt;span class="nt">&amp;lt;/id&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;name&amp;gt;&lt;/span>Resources&lt;span class="nt">&amp;lt;/name&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;description&amp;gt;&lt;/span>File repository-Resources&lt;span class="nt">&amp;lt;/description&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;is_default&amp;gt;&lt;/span>true&lt;span class="nt">&amp;lt;/is_default&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;base_directory&amp;gt;&lt;/span>/home/etl/data-integration/Resources&lt;span class="nt">&amp;lt;/base_directory&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;read_only&amp;gt;&lt;/span>N&lt;span class="nt">&amp;lt;/read_only&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;hides_hidden_files&amp;gt;&lt;/span>N&lt;span class="nt">&amp;lt;/hides_hidden_files&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/repository&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/repositories&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="13-上传文件到服务器资源库">1.3 上传文件到服务器资源库&lt;/h3>
&lt;p>将配置好的作业和转换xml文件上传至服务器资源库，例如使用 &lt;code>xftp&lt;/code> 等工具&lt;/p>
&lt;h2 id="2调试配置调度">2.调试配置调度&lt;/h2>
&lt;h3 id="21-测试单次调用">2.1 测试单次调用&lt;/h3>
&lt;p>使用 &lt;code>curl&lt;/code> 工具通过Kettle自带接口触发作业单次执行。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ curl -u &lt;span class="o">{&lt;/span>用户名&lt;span class="o">}&lt;/span>:&lt;span class="o">{&lt;/span>密码&lt;span class="o">}&lt;/span> &lt;span class="s2">&amp;#34;http://{ip}:{port}/kettle/executeJob/?rep={资源库名称}&amp;amp;job={作业名称}&amp;#34;&lt;/span>&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>说明：&lt;/p>
&lt;ol>
&lt;li>用户名和密码是Kettle子服务器的密码&lt;/li>
&lt;li>&lt;code>{}&lt;/code> 代表替换参数，url中有 &lt;code>&amp;amp;&lt;/code> 所以整体需要加上 &lt;code>&amp;quot;&amp;quot;&lt;/code>&lt;/li>
&lt;li>Kettle自带接口的触发机制不在本文讨论范围，只需要知道可以以get请求固定格式url即可执行指定作业就好了&lt;/li>
&lt;/ol>
&lt;p>实例：触发执行本机Resources资源库的0494J作业&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ curl -u cluster:cluster &lt;span class="s2">&amp;#34;http://127.0.0.1:8080/kettle/executeJob/?rep=Resources&amp;amp;job=0494J&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html" target="_blank" rel="noopener"
>这里&lt;/a>是curl的用法指南。&lt;/p>
&lt;p>通了会显示如下信息，异常则会显示相应异常信息:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;webresult&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;result&amp;gt;&lt;/span>OK&lt;span class="nt">&amp;lt;/result&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;message&amp;gt;&lt;/span>Job started&lt;span class="nt">&amp;lt;/message&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;id&amp;gt;&lt;/span>d996f743-bc27-46da-862b-6ea8be6cf4d2&lt;span class="nt">&amp;lt;/id&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/webresult&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="22-配置循环调度">2.2 配置循环调度&lt;/h3>
&lt;p>使用 &lt;code>crontab&lt;/code> 工具实现循环调度。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ crontab -l &lt;span class="c1"># 显示当前用户所有cron任务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ crontab -e &lt;span class="c1"># 编辑修改增删cron任务，编辑器走VISUAL或EDITOR环境变量，可通过 `echo $EDITOR` 命令查看&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ tail -f /var/log/cron &lt;span class="c1"># 查看cron任务执行日志&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>实例：创建一个每5分钟执行一次的调度任务&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ crontab -e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*/5 * * * * /usr/bin/curl -u cluster:cluster &lt;span class="s2">&amp;#34;http://127.0.0.1:8080/kettle/executeJob/?rep=Resources&amp;amp;job=0494J&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://crontab.guru/" target="_blank" rel="noopener"
>这里&lt;/a>是crontab的用法指南。
&lt;a class="link" href="https://cloud.tencent.com/developer/article/1951645" target="_blank" rel="noopener"
>这里&lt;/a>是vim的用法指南。&lt;/p></description></item></channel></rss>